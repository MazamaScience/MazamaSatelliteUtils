---
title: "Grid Sizes"
author: "Mazama Science"
date: "8/2/2019"
output: html_document
vignette: >
  %\VignetteIndexEntry{Grid Sizes}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(MazamaSatelliteUtils)
library(MazamaSpatialUtils)

setSatelliteDataDir("~/Data/Satellite")
setSpatialDataDir("~/Data/Spatial")

# get bbox for Texas
loadSpatialData("USCensusStates")
tx <- subset(USCensusStates, stateCode == "TX")
bb_tx <- sp::bbox(tx)

nc <- goesaodc_openFile("OR_ABI-L2-AODC-M6_G16_s20191291201274_e20191291204047_c20191291210009.nc")
pal <- colorRampPalette(c("khaki", "orangered"))

#par(mfrow=c(1, 3))
rstr <- goesaodc_createRaster(nc, bbox = bb_tx, res = 0.1)
raster::plot(rstr, "AOD", col = pal(100))
plot(tx, add = TRUE)

if(FALSE){
rstr <- goesaodc_createRaster(nc, bbox = bb_tx, res = 0.3)
raster::plot(rstr, "AOD", col = pal(100))
plot(tx, add = TRUE)

rstr <- goesaodc_createRaster(nc, bbox = bb_tx, res = 1.0)
raster::plot(rstr, "AOD", col = pal(100))
plot(tx, add = TRUE)
}
```

```{r, fig.width=12, fig.height=8 }
nc <- goesaodc_openFile("OR_ABI-L2-AODC-M6_G16_s20191291201274_e20191291204047_c20191291210009.nc")
tb <- goesaodc_createTibble(nc)
bb_tx_dense <- c(-97, -96, 27, 28)
tb_tx_dense <- dplyr::filter(tb, 
                             lon > bb_tx_dense[1], lon < bb_tx_dense[2], 
                             lat > bb_tx_dense[3], lat < bb_tx_dense[4])
pal_aod <- colorRampPalette(c("khaki", "orangered"))

rstr <- goesaodc_createRaster(nc, 
                              lonLo = bb_tx_dense[1], lonHi = bb_tx_dense[2], 
                              latLo = bb_tx_dense[3], latHi = bb_tx_dense[4], 
                              res = 0.08,
                              fun = mean)


tb_tx_dense$col <- pal_aod(25)[as.numeric(cut(tb_tx_dense$AOD, breaks = 25))]



raster::plot(rstr, "AOD", col = pal_aod(25), xlim = c(-97, -96), ylim = c(27, 28))
plot(tx, add = TRUE)
points(tb_tx_dense$lon, tb_tx_dense$lat, pch = 16, cex = 0.5, col = tb_tx_dense$col)
```