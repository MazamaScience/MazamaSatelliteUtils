---
title: "Other Locations"
author: "Helen Miller"
date: "6/26/2018"
output: html_document
params:
  spatialDataDir: "~/Data/Spatial"
  maiacDataDir: "~/Data/maiac"
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
# get params
spatialDataDir <- params$spatialDataDir
maiacDataDir <- params$maiacDataDir

# Load packages
library(AirfireNasaMaiac)
library(PWFSLSmoke)
library(PWFSLSmokeModeling)
logger.setup()
setMaiacDataDir(maiacDataDir)

# load spatial data
setSpatialDataDir(spatialDataDir)
loadSpatialData("USCensusStates")
```

```{r loadingMonitoringData, cache = TRUE, include = FALSE}
airnow <- airnow_load(2017)
wrcc <- wrcc_load(2017)
airsis <- airsis_load(2017)
all_monitors <- monitor_combine(list(airnow, wrcc, airsis))
ca_monitors <- monitor_subset(all_monitors, stateCodes = "CA")

thresholds <- c(0, .14276, .360, .468, 1.284, 1.815, 3)

```

# Chetco bar and other fires near the Oregon border

Chetco bar burned July 12-Nov 2. We have to knit together two different tiles, but this is not too difficult. This option might have the most high-smoke data. There was a lot of smoke in this region for many weeks. There are plenty of monitors but some large areas with no monitors. It is also not confined only to California. The Chetco Bar fire was in Oregon but smoke blew south. 

```{r chetcoMons}
chetcoMons <- monitor_subset(all_monitors, ylim = c(39, 43), xlim = c(-125, -118))
plot(subset(USCensusStates, stateCode == "CA"), main = "Monitors surrounding Chetco fire area")
monitorMap(chetcoMons, add = TRUE)
```


### Neighboring monitor values
```{r chetcotimeseries}
monitorPlot_timeseries(chetcoMons, tlim = c(20170712, 20171102), main = "Neighboring monitor values")
```


### Smokiest days in Sept
```{r chetcotimeseriesSep}
monitorPlot_timeseries(chetcoMons, tlim = c(20170901, 20170910), main = "Neighboring monitor values")
```


```{r chetcoAOD}
chetcoSep01N <- maiac_loadRaster("h01v03", 20170901, 2050, converterPath = "../executables/h4toncff_nc4") 
chetcoSep01S <- maiac_loadRaster("h01v04", 20170901, 2045, converterPath = "../executables/h4toncff_nc4") 
chetcoSep01 <- raster::merge(chetcoSep01N, chetcoSep01S) %>%
  projectRaster(crs = CRS("+proj=longlat +ellps=GRS80 +datum=NAD83 +no_defs +towgs84=0,0,0"))

chetcoSep03N <- maiac_loadRaster("h01v03", 20170903, 2035, converterPath = "../executables/h4toncff_nc4") 
chetcoSep03S <- maiac_loadRaster("h01v04", 20170903, 2035, converterPath = "../executables/h4toncff_nc4") 
chetcoSep03 <- raster::merge(chetcoSep03N, chetcoSep03S) %>%
  projectRaster(crs = CRS("+proj=longlat +ellps=GRS80 +datum=NAD83 +no_defs +towgs84=0,0,0"))

plot(chetcoSep01, breaks = thresholds, col = adjustcolor(AQI$colors, alpha.f = .3), colNA = "gray90", xlim = c(-125, -118), ylim = c(39, 43), main = "Sept 01, Aqua (2pm)", legend = FALSE)
plot(USCensusStates, add = TRUE)
monitor_subset(chetcoMons, tlim = c(2017090121, 2017090122)) %>%
  monitorMap(add = TRUE)


plot(chetcoSep03, breaks = thresholds, col = adjustcolor(AQI$colors, alpha.f = .3), colNA = "gray90", xlim = c(-125, -118), ylim = c(39, 43), main = "Sept 03, Aqua (2pm)", legend = FALSE)
plot(USCensusStates, add = TRUE)
monitor_subset(chetcoMons, tlim = c(2017090321, 2017090322)) %>%
  monitorMap(add = TRUE)
```


# Detwiler Fire

Detwiler burned July 16-Aug 24. The smoke is not as extensive as the border fire smoke. Some of the smokiest days unfortunately appear to be clouded over. 

```{r detwiler}
detMons <- monitor_subset(ca_monitors, ylim = c(36, 39), xlim = c(-122, -118))
plot(subset(USCensusStates, stateCode == "CA"))
monitorMap(detMons, add = TRUE)
points(-120.21321, 37.61757, pch = 17)
```

### Neighboring monitor values  
```{r dettimeseries}
monitorPlot_timeseries(detMons)
```

### Smokiest days in July  
```{r dettimeseriesjuly}
monitorPlot_timeseries(detMons, tlim = c(20170714, 20170730))
```

### Smokiest days in September
```{r dettimeseriessept}
monitorPlot_timeseries(detMons, tlim = c(20170901, 20170930))
```

```{r detAOD}
detJul20 <- maiac_loadRaster("h01v04", 20170720, converterPath = "../executables/h4toncff_nc4") %>%
  projectRaster(crs = CRS("+proj=longlat +ellps=GRS80 +datum=NAD83 +no_defs +towgs84=0,0,0"))
detJul21 <- maiac_loadRaster("h01v04", 20170721, 2150, converterPath = "../executables/h4toncff_nc4") %>%
  projectRaster(crs = CRS("+proj=longlat +ellps=GRS80 +datum=NAD83 +no_defs +towgs84=0,0,0"))
detSep03 <- maiac_loadRaster("h01v04", 20170903, converterPath = "../executables/h4toncff_nc4") %>%
  projectRaster(crs = CRS("+proj=longlat +ellps=GRS80 +datum=NAD83 +no_defs +towgs84=0,0,0"))
detSep05 <- maiac_loadRaster("h01v04", 20170905, 2020, converterPath = "../executables/h4toncff_nc4") %>%
  projectRaster(crs = CRS("+proj=longlat +ellps=GRS80 +datum=NAD83 +no_defs +towgs84=0,0,0"))


plot(detJul20, breaks = thresholds, col = adjustcolor(AQI$colors, alpha.f = .3), colNA = "gray90", ylim = c(36, 39), xlim = c(-122, -118), legend = FALSE, main = "Jul 20, Aqua (2pm)")
points(-120.21321, 37.61757, pch = 17)
monitor_subset(detMons, tlim = c(2017072021, 2017072022)) %>%
  monitorMap(add = TRUE)
plot(USCensusStates, add = TRUE)

plot(detJul21, breaks = thresholds, col = adjustcolor(AQI$colors, alpha.f = .3), colNA = "gray90",  ylim = c(36, 39), xlim = c(-122, -118), legend = FALSE, main = "Jul 21, Aqua (2pm)")
points(-120.21321, 37.61757, pch = 17)
monitor_subset(detMons, tlim = c(2017072121, 2017072122)) %>%
  monitorMap(add = TRUE)
plot(USCensusStates, add =TRUE)

plot(detSep03, breaks = thresholds, col = adjustcolor(AQI$colors, alpha.f = .3), colNA = "gray90",  ylim = c(36, 39), xlim = c(-122, -118), legend = FALSE, main = "Sept 3, Aqua (2pm)")
points(-120.21321, 37.61757, pch = 17)
monitor_subset(detMons, tlim = c(2017090321, 2017090322)) %>%
  monitorMap(add = TRUE)
plot(USCensusStates, add =TRUE)

plot(detSep05, breaks = thresholds, col = adjustcolor(AQI$colors, alpha.f = .3), colNA = "gray90",  ylim = c(36, 39), xlim = c(-122, -118), legend = FALSE, main = "Sept 5, Aqua (2pm)")
points(-120.21321, 37.61757, pch = 17)
monitor_subset(detMons, tlim = c(2017090521, 2017090522)) %>%
  monitorMap(add = TRUE)
plot(USCensusStates, add =TRUE)

```

# Thomas Fire (Santa Barbara)

Dec 4 - Jan 12. MAIAC data only goes through the end of November, 2017. 
