---
title: "Camp Fire"
author: "Jonathan Callahan"
date: "5/20/2019"
output: html_document
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      fig.width = 7,
                      fig.height = 5)
```

Starting from 2019-04-03:

```{r load_data}
library(maps)
library(MazamaSpatialUtils)
library(MazamaSatelliteUtils)

setSpatialDataDir('~/Data/Spatial')
setSatelliteDataDir('../local_data/CampFire/001')

# load a file with 22:00 UTC = 15:00 PDT
filename <- "OR_ABI-L2-AODC-M3_G16_s20183192207157_e20183192209530_c20183192212207.nc"
nc <- goesaodc_openFile(filename = filename)

```

Let's see if there is any data

```{r full_spatial_points}
sp <- goesaodc_createSpatialPoints(nc)
map('world',xlim=c(-140,-40),ylim=c(10,60))
goesaodc_plotSpatialPoints(sp, add = TRUE, cex=0.2)
```

Lots of data and some high values over the bay area. Excellent!

Let's focus on California:

```{r ca_spatial_points}
loadSpatialData("USCensusStates")
ca <- subset(USCensusStates, stateCode == "CA")
bb_ca <- bbox(ca)
sp_ca <- goesaodc_createSpatialPoints(nc, bb_ca)
map('county', 'ca')
goesaodc_plotSpatialPoints(sp_ca, add=TRUE, cex=0.2)
```

Looks about the right shape for the Camp fire but it appears that the area
with the most smoke has been flagged as bad. 

Let's try creating a raster:

```{r ca_raster}
raster_ca <- goesaodc_createRaster(nc, bbox = bb_ca)
raster::plot(raster_ca, "AOD")
map('county', 'ca', add = TRUE)
```

We will need some dedicated raster plotting function that chooses good breaks
and colors.

Let's zoom in and test creating a higher resolution raster.

```{r ca_raster_hires}
raster_ca <- goesaodc_createRaster(
  nc,
  res = 0.02,
  lonLo = -124,
  lonHi = -120,
  latLo = 36,
  latHi = 40
)
raster::plot(raster_ca, "AOD")
map('county', 'ca', add = TRUE)
```

