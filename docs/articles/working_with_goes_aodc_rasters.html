<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Working With GOES AODC Rasters • MazamaSatelliteUtils</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Working With GOES AODC Rasters">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">MazamaSatelliteUtils</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/goes-east_data_quality_limits.html">GOES-East Data Quality Spatial Limits</a>
    </li>
    <li>
      <a href="../articles/grid_sizes.html">Grid Sizes</a>
    </li>
    <li>
      <a href="../articles/intro_to_goes_aodc_data.html">Intro to GOES AODC Data</a>
    </li>
    <li>
      <a href="../articles/working_with_goes_aodc_rasters.html">Working With GOES AODC Rasters</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Working With GOES AODC Rasters</h1>
                        <h4 class="author">Mazama Science</h4>
            
            <h4 class="date">8/12/2019</h4>
      
      
      <div class="hidden name"><code>working_with_goes_aodc_rasters.Rmd</code></div>

    </div>

    
    
<div id="raster-objects" class="section level2">
<h2 class="hasAnchor">
<a href="#raster-objects" class="anchor"></a>Raster Objects</h2>
<p>A Raster is used to store and visualize information that is “gridded” like the pixels of an image. It is tailored towards visualizing geospatial data so that each pixel (or “cell”) of the Raster covers a small area of the Earth’s surface and the color represents the value of a measurement, such as aerosol optical depth. A Raster is creted in several steps, bu the process can be streamlined with <code>MazamaSatelliteUtils</code> functions. Let’s walk through the process first though to understand what Rasters are made of and how they are put together:</p>
<p><a href="https://www.neonscience.org/raster-res-extent-pixels-r">more</a></p>
</div>
<div id="creating-a-rasterlayer" class="section level2">
<h2 class="hasAnchor">
<a href="#creating-a-rasterlayer" class="anchor"></a>Creating a RasterLayer</h2>
<p>Before any data can actually be rastered, a RasterLayer must first be defined in order to to set up the grid to draw to. This grid is given a bounding box with min/max longitudes and latitudes as well as a horizontal and vertical resolution given the number of rows and columns of cells. Like a digital image, more pixels results in a sharper and less blocky result.</p>
<p>The last requirement is a Coordinate Reference System (CRS) <code>proj4string</code>. This is necessary to project the RasterLayer over the correct area on Earth using standard points of reference. “+proj=longlat +datum=WGS84 +ellps=GRS80” is the default we use and can be broken up into several elements:</p>
<ol style="list-style-type: decimal">
<li><p>proj=longlat: The projection system to use in order to transform 3D spherical world coordinates onto our 2D screen. In this case we’ll use longitude and latitude. There are quite a lot of <a href="https://proj.org/operations/projections/index.html">others</a> to choose from.</p></li>
<li><p>datum=WGS84: A coordinate system for the Earth. The WGS84 (World Geodetic System 1984) is a common standard and is used for Google Maps.</p></li>
<li><p>ellps=GRS80: The ellipsoid used to model the Earth. GRS80 and WGS84 are almost identical.</p></li>
</ol>
<p>Further reading on CRS and projections: <a href="https://gisgeography.com/wgs84-world-geodetic-system/">More on geodetic systems</a> <a href="https://proj.org/">PROJ4</a> <a href="https://rspatial.org/spatial/6-crs.html">more on CRS</a>. <a href="https://www.nceas.ucsb.edu/~frazier/RSpatialGuides/OverviewCoordinateReferenceSystems.pdf">Overview of Coordinate Reference Systems (CRS) in R</a> <a href="https://mgimond.github.io/Spatial/coordinate-systems-in-r.html">Coordinate Systems in R</a></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">res &lt;-<span class="st"> </span><span class="fl">0.05</span>
bbox &lt;-<span class="st"> </span>sp<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/sp/topics/bbox">bbox</a></span>(florida)

lon_min &lt;-<span class="st"> </span>bbox[<span class="dv">1</span>, <span class="dv">1</span>]
lon_max &lt;-<span class="st"> </span>bbox[<span class="dv">1</span>, <span class="dv">2</span>]
lat_min &lt;-<span class="st"> </span>bbox[<span class="dv">2</span>, <span class="dv">1</span>]
lat_max &lt;-<span class="st"> </span>bbox[<span class="dv">2</span>, <span class="dv">2</span>]

ncols &lt;-<span class="st"> </span>((lon_max <span class="op">-</span><span class="st"> </span>lon_min) <span class="op">/</span><span class="st"> </span>res) <span class="op">+</span><span class="st"> </span><span class="dv">1</span>
nrows &lt;-<span class="st"> </span>((lat_max <span class="op">-</span><span class="st"> </span>lat_min) <span class="op">/</span><span class="st"> </span>res) <span class="op">+</span><span class="st"> </span><span class="dv">1</span>

rasterLayer &lt;-<span class="st"> </span>raster<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/raster/topics/raster">raster</a></span>(<span class="dt">nrows =</span> nrows, <span class="dt">ncols =</span> ncols,
                              <span class="dt">xmn =</span> lon_min, <span class="dt">xmx =</span> lon_max,
                              <span class="dt">ymn =</span> lat_min, <span class="dt">ymx =</span> lat_max,
                              <span class="dt">crs =</span> <span class="st">"+proj=longlat +datum=WGS84 +ellps=GRS80"</span>)</code></pre></div>
</div>
<div id="rasterizing-spatialpoints" class="section level2">
<h2 class="hasAnchor">
<a href="#rasterizing-spatialpoints" class="anchor"></a>Rasterizing SpatialPoints</h2>
<p>Once the <code>RasterLayer</code> grid is defined, we can rasterize all of the readings from our <code>SpatialPoints</code> object with the <code>rasterize</code> function. Now we have to decide how our cells should be colored based on SpatialPoint measurements. A cell will not be defined if it doesn’t contain any points, but what if it contains more than one point? For this case we define the <code>fun</code> parameter for <code>rasterize</code>, which determines how to calculate one summarizing value from many points. By default this is set to be the “mean” value for all the points in the cell.</p>
<p>The result of this function is a <code>RasterBrick</code> with a separate <code>RasterLayer</code> for each variable.</p>
<p><img src="working_with_goes_aodc_rasters_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<p>The “ID” layer is included automatically–coloring each cell by the ID numbers of the features in the <code>SpatialPoints</code> object. While it’s not very helpful in determining air quality, it does give a nice visual for how the GOES-16 ABI scans the Earth from North to South. As the ID plot legend suggests, there are about 70,000 SpatialPoint features in all:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">spatialPoints</code></pre></div>
<pre><code>## class       : SpatialPointsDataFrame 
## features    : 72174 
## extent      : -87.63462, -80.03147, 24.52314, 31.00079  (xmin, xmax, ymin, ymax)
## coord. ref. : NA 
## variables   : 2
## names       :               AOD, DQF 
## min values  : -2.57494801926077,   0 
## max values  :  2.47463977776351,   2</code></pre>
<p>The AOD and DQF measurements are more useful for our atmospheric analysis. Let’s plot them with the state border on top:</p>
<p><img src="working_with_goes_aodc_rasters_files/figure-html/unnamed-chunk-4-1.png" width="768"></p>
<p>The process for creating this final RasterBrick is streamlined by the <code>MazmaSatelliteUtils</code> function <code>goesaodc_createRaster</code>. The following code produces the exact same result without having to go through the steps of explicitly defining a new RasterLayer and rastering to it:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rb_simpler &lt;-<span class="st"> </span><span class="kw"><a href="../reference/goesaodc_createRaster.html">goesaodc_createRaster</a></span>(<span class="dt">nc =</span> nc, <span class="dt">res =</span> res, <span class="dt">fun =</span> mean, <span class="dt">bbox =</span> bbox)

<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(rb_simpler<span class="op">$</span>AOD, <span class="dt">main =</span> <span class="st">"AOD"</span>, <span class="dt">col =</span> <span class="kw">pal_aod</span>(<span class="dv">50</span>))
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(florida, <span class="dt">add =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="working_with_goes_aodc_rasters_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
</div>
<div id="raster-metrics" class="section level2">
<h2 class="hasAnchor">
<a href="#raster-metrics" class="anchor"></a>Raster Metrics</h2>
<p>We can select several different <code>fun</code> methods besides <code>mean</code> to calculate the final value for a cell. There are the usual statistical functions: <code>median</code>, <code>sd</code>, <code>min</code>, <code>max</code>, as well as several specific functions provided by rasterize: “count”, “first”, and “last”. “last” is used by default.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rb_mean   &lt;-<span class="st"> </span>raster<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/raster/topics/rasterize">rasterize</a></span>(spatialPoints, rasterLayer, <span class="dt">fun =</span> mean)
rb_median &lt;-<span class="st"> </span>raster<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/raster/topics/rasterize">rasterize</a></span>(spatialPoints, rasterLayer, <span class="dt">fun =</span> median)
rb_sd     &lt;-<span class="st"> </span>raster<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/raster/topics/rasterize">rasterize</a></span>(spatialPoints, rasterLayer, <span class="dt">fun =</span> sd)
rb_count  &lt;-<span class="st"> </span>raster<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/raster/topics/rasterize">rasterize</a></span>(spatialPoints, rasterLayer, <span class="dt">fun =</span> <span class="st">"count"</span>)

<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/par">par</a></span>(<span class="dt">mfrow=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">2</span>, <span class="dv">2</span>), <span class="dt">mar=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">3</span>))
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(rb_mean<span class="op">$</span>AOD,   <span class="dt">main =</span> <span class="st">"AOD Mean"</span>, <span class="dt">col =</span> <span class="kw">pal_aod</span>(<span class="dv">50</span>))
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(rb_median<span class="op">$</span>AOD, <span class="dt">main =</span> <span class="st">"AOD Median"</span>, <span class="dt">col =</span> <span class="kw">pal_aod</span>(<span class="dv">50</span>))
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(rb_sd<span class="op">$</span>AOD,     <span class="dt">main =</span> <span class="st">"AOD Standard Deviation"</span>, <span class="dt">col =</span> <span class="kw">pal_aod</span>(<span class="dv">50</span>))
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(rb_count<span class="op">$</span>AOD,  <span class="dt">main =</span> <span class="st">"Points in Cells"</span>, <span class="dt">col =</span> <span class="kw">pal_aod</span>(<span class="dv">50</span>))</code></pre></div>
<p><img src="working_with_goes_aodc_rasters_files/figure-html/unnamed-chunk-6-1.png" width="768"></p>
</div>
<div id="rasterstacks-and-averaging" class="section level2">
<h2 class="hasAnchor">
<a href="#rasterstacks-and-averaging" class="anchor"></a>RasterStacks and Averaging</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rasterVis<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/rasterVis/topics/levelplot-methods">levelplot</a></span>(rasterBrick<span class="op">$</span>AOD, <span class="dt">main =</span> <span class="st">"AOD"</span>, <span class="dt">margin =</span> <span class="ot">FALSE</span>)</code></pre></div>
<p><img src="working_with_goes_aodc_rasters_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#raster-objects">Raster Objects</a></li>
      <li><a href="#creating-a-rasterlayer">Creating a RasterLayer</a></li>
      <li><a href="#rasterizing-spatialpoints">Rasterizing SpatialPoints</a></li>
      <li><a href="#raster-metrics">Raster Metrics</a></li>
      <li><a href="#rasterstacks-and-averaging">RasterStacks and Averaging</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Jonathan Callahan, Helen Miller, Raffuse Sean, Rex Thompson, Thomas Bergamaschi.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
