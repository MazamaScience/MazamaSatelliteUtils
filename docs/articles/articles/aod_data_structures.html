<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Working with AODC Data Structures • MazamaSatelliteUtils</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="Working with AODC Data Structures">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">MazamaSatelliteUtils</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.13</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/articles/Kincade_Fire_Example.html">Kincade Fire Example</a>
    </li>
    <li>
      <a href="../../articles/articles/Milepost_97_example.html">Milepost 97 Example</a>
    </li>
    <li>
      <a href="../../articles/articles/aod_data_format.html">AOD Data Format</a>
    </li>
    <li>
      <a href="../../articles/articles/aod_data_structures.html">Working with AODC Data Structures</a>
    </li>
    <li>
      <a href="../../articles/articles/goes-east_data_quality_limits.html">GOES-East Data Quality Spatial Limits</a>
    </li>
    <li>
      <a href="../../articles/articles/grid_sizes.html">Grid Sizes</a>
    </li>
    <li>
      <a href="../../articles/articles/working_with_goes_aodc_rasters.html">Working With GOES AODC Rasters</a>
    </li>
    <li>
      <a href="../../articles/articles/working_with_mazma_satellite_utils.html">Working with Mazama Satellite Utils</a>
    </li>
    <li>
      <a href="../../articles/intro_to_mazama_satellite_utils.html">Introduction to MazamaSatelliteUtils</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Working with AODC Data Structures</h1>
                        <h4 class="author">Mazama Science</h4>
            
            <h4 class="date">1/8/2020</h4>
      
      
      <div class="hidden name"><code>aod_data_structures.Rmd</code></div>

    </div>

    
    
<p>The <strong>MazamaSpatialUtils</strong> package utilizes several different data structures that represent different levels of processing of GOES AOD data. As stored in the NetCDF files, the AOD is on its “native” pixel grid, with <code>x</code> and <code>y</code> representing scan angles as opposed to longitude and latitude. Each image is a snapshot of the spherical earth and thus the grid is inherently curvilinear.</p>
<p>This raw, curvilinear data is processed into different data structures, step-by-step with the following functions:</p>
<ol style="list-style-type: decimal">
<li>
<code>createNativeGrid()</code> – returns <code>list</code> of <code>array</code>s with native pixel grid</li>
<li>
<code>createTibble()</code> – returns <code>tibble</code> with longitude, latitude, value</li>
<li>
<code>createSpatialPoints()</code> – returns <strong>sp</strong> package <code>SpatialPointsDataFrame</code>
</li>
<li>
<code>createRaster()</code> – returns <strong>raster</strong> package <code>raster</code>
</li>
<li>
<code>createRasterStack()</code> – returns <strong>raster</strong> package <code>rasterStack</code>
</li>
</ol>
<p>Each successive data structure is described in the sections below.</p>
<p>Here we set things up with data from the 2019 Kincade fire in California:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(MazamaSatelliteUtils)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"></a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="kw"><a href="../../reference/setSatelliteDataDir.html">setSatelliteDataDir</a></span>(<span class="st">"~/Data/Satellite"</span>)</a>
<a class="sourceLine" id="cb1-4" data-line-number="4"></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="kw"><a href="../../reference/goesaodc_downloadAOD.html">goesaodc_downloadAOD</a></span>(</a>
<a class="sourceLine" id="cb1-6" data-line-number="6">  <span class="dt">satID =</span> <span class="st">"G17"</span>,</a>
<a class="sourceLine" id="cb1-7" data-line-number="7">  <span class="dt">datetime =</span> <span class="st">"2019-10-27 14:00"</span>,</a>
<a class="sourceLine" id="cb1-8" data-line-number="8">  <span class="dt">timezone =</span> <span class="st">"America/Los_Angeles"</span></a>
<a class="sourceLine" id="cb1-9" data-line-number="9">)</a>
<a class="sourceLine" id="cb1-10" data-line-number="10"></a>
<a class="sourceLine" id="cb1-11" data-line-number="11">files &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/goesaodc_listFiles.html">goesaodc_listFiles</a></span>(<span class="st">"G17"</span>, <span class="st">"2019-10-27 14:00"</span>, <span class="dt">timezone =</span> <span class="st">"America/Los_Angeles"</span>)</a>
<a class="sourceLine" id="cb1-12" data-line-number="12"></a>
<a class="sourceLine" id="cb1-13" data-line-number="13">ncList &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>()</a>
<a class="sourceLine" id="cb1-14" data-line-number="14"><span class="cf">for</span> ( file <span class="cf">in</span> files ) {</a>
<a class="sourceLine" id="cb1-15" data-line-number="15">  label &lt;-</a>
<a class="sourceLine" id="cb1-16" data-line-number="16"><span class="st">    </span>file <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1-17" data-line-number="17"><span class="st">    </span><span class="kw"><a href="../../reference/goesaodc_convertFilenameToDatetime.html">goesaodc_convertFilenameToDatetime</a></span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1-18" data-line-number="18"><span class="st">    </span>MazamaCoreUtils<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/MazamaCoreUtils/man/timeStamp.html">timeStamp</a></span>(<span class="dt">unit =</span> <span class="st">"sec"</span>, <span class="dt">timezone =</span> <span class="st">"UTC"</span>)</a>
<a class="sourceLine" id="cb1-19" data-line-number="19">  ncList[[label]] &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/goesaodc_openFile.html">goesaodc_openFile</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/basename.html">basename</a></span>(file))</a>
<a class="sourceLine" id="cb1-20" data-line-number="20">}</a></code></pre></div>
<div id="nativegrid" class="section level2">
<h2 class="hasAnchor">
<a href="#nativegrid" class="anchor"></a>NativeGrid</h2>
<p>At the lowest level, data are accessible on the native, curvilinear grid by using the <code>goesaodc_nativGrid()</code> function. This function finds the native grid cells which are bounded by the incoming <code>bbox</code> and returns a <code>list</code> of <code>array</code>s named <code>lon</code>, <code>lat</code>, <code>AOD</code> and <code>DQF</code>. Individual elements can be viewd with <code><a href="https://rdrr.io/r/graphics/image.html">graphics::image()</a></code>.</p>
<p>While GOES AODC CONUS images are commonly 3+ Megabytes, specification of <code>bbox</code> allows ingest of much smaller subsets with a minimal memory footprint.</p>
<p><em>Note that we have to reverse the j indices when using <code>base::image()</code>.</em></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="co"># Using previously defined variables</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2">kincade_bbox &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="op">-</span><span class="dv">124</span>, <span class="dv">-120</span>, <span class="dv">36</span>, <span class="dv">39</span>)</a>
<a class="sourceLine" id="cb2-3" data-line-number="3"></a>
<a class="sourceLine" id="cb2-4" data-line-number="4">nativeGrid &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/goesaodc_createNativeGrid.html">goesaodc_createNativeGrid</a></span>(ncList[[<span class="dv">1</span>]], kincade_bbox)</a>
<a class="sourceLine" id="cb2-5" data-line-number="5"></a>
<a class="sourceLine" id="cb2-6" data-line-number="6">j_indices &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span>(nativeGrid<span class="op">$</span>lon)<span class="op">:</span><span class="dv">1</span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"></a>
<a class="sourceLine" id="cb2-8" data-line-number="8"><span class="kw"><a href="https://rdrr.io/r/graphics/layout.html">layout</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="dt">nrow =</span> <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb2-9" data-line-number="9"></a>
<a class="sourceLine" id="cb2-10" data-line-number="10"><span class="kw"><a href="https://rdrr.io/r/graphics/image.html">image</a></span>(nativeGrid<span class="op">$</span>lon[, j_indices])</a>
<a class="sourceLine" id="cb2-11" data-line-number="11"><span class="kw"><a href="https://rdrr.io/r/graphics/title.html">title</a></span>(<span class="st">"Native Grid -- lon"</span>)</a>
<a class="sourceLine" id="cb2-12" data-line-number="12"><span class="kw"><a href="https://rdrr.io/r/graphics/image.html">image</a></span>(nativeGrid<span class="op">$</span>lat[, j_indices])</a>
<a class="sourceLine" id="cb2-13" data-line-number="13"><span class="kw"><a href="https://rdrr.io/r/graphics/title.html">title</a></span>(<span class="st">"Native Grid -- lat"</span>)</a>
<a class="sourceLine" id="cb2-14" data-line-number="14"><span class="kw"><a href="https://rdrr.io/r/graphics/image.html">image</a></span>(nativeGrid<span class="op">$</span>AOD[, j_indices])</a>
<a class="sourceLine" id="cb2-15" data-line-number="15"><span class="kw"><a href="https://rdrr.io/r/graphics/title.html">title</a></span>(<span class="st">"Native Grid -- AOD"</span>)</a>
<a class="sourceLine" id="cb2-16" data-line-number="16"><span class="kw"><a href="https://rdrr.io/r/graphics/image.html">image</a></span>(nativeGrid<span class="op">$</span>DQF[, j_indices])</a>
<a class="sourceLine" id="cb2-17" data-line-number="17"><span class="kw"><a href="https://rdrr.io/r/graphics/title.html">title</a></span>(<span class="st">"Native Grid -- DQF"</span>)</a></code></pre></div>
<p><img src="aod_data_structures_files/figure-html/native_grid-1.png" width="576"></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/graphics/layout.html">layout</a></span>(<span class="dv">1</span>)</a></code></pre></div>
</div>
<div id="tibble" class="section level2">
<h2 class="hasAnchor">
<a href="#tibble" class="anchor"></a>Tibble</h2>
<p>Once the desired data have been ingested, the next step is to create a <code>tibble</code> (modern <code>data.frame</code>) where each record has the <code>lon, lat, AOD, DQF</code> associated with a single pixel. Internally, this data structure is used to subset data based on rectangular lat-lon boundaries.</p>
<p>This datas tructure and the <em>nativeGrid</em> list are primarily used internally and rarely of interest to an end user. The <code><a href="../../reference/goesaodc_createTibble.html">goesaodc_createTibble()</a></code> calls `goesaodc_createNativeGrid() internally.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="co"># Using previously defined variables</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2">tibble &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/goesaodc_createTibble.html">goesaodc_createTibble</a></span>(ncList[[<span class="dv">1</span>]], kincade_bbox)</a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(tibble)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 4
##     lon   lat    AOD   DQF
##   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
## 1 -124.  39.0 0.0698     0
## 2 -124.  39.0 0.0469     0
## 3 -124.  39.0 0.0401     0
## 4 -124.  39.0 0.0466     0
## 5 -124.  39.0 0.0358     0
## 6 -124.  39.0 0.0483     0</code></pre>
</div>
<div id="spatial-points" class="section level2">
<h2 class="hasAnchor">
<a href="#spatial-points" class="anchor"></a>Spatial Points</h2>
<p>The first <em>spatial</em> data structure is created by <code><a href="../../reference/goesaodc_createSpatialPoints.html">goesaodc_createSpatialPoints()</a></code> which calls <code><a href="../../reference/goesaodc_createTibble.html">goesaodc_createTibble()</a></code> internally and uses the <strong>sp</strong> package to convert the tibble into a <code>SpatialPointsDataFrame</code>. This data structure is useful for creating maps showing pixels in their native grid position.</p>
<p>The <code><a href="../../reference/goesaodc_plotSpatialPoints.html">goesaodc_plotSpatialPoints()</a></code> function can plot the AOD values from this data structure as filtered by the requested <code>dqfLevel</code>.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="co"># Using previously defined variables</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2">SPDF &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/goesaodc_createSpatialPoints.html">goesaodc_createSpatialPoints</a></span>(ncList[[<span class="dv">1</span>]], <span class="dt">dqfLevel =</span> <span class="dv">3</span>, <span class="dt">bbox =</span> kincade_bbox)</a>
<a class="sourceLine" id="cb6-3" data-line-number="3">maps<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/maps/man/map.html">map</a></span>(<span class="dt">database =</span> <span class="st">"state"</span>, <span class="st">"regions"</span> =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"california"</span>), <span class="dt">xlim =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="op">-</span><span class="dv">126</span>, <span class="fl">-113.5</span>))</a>
<a class="sourceLine" id="cb6-4" data-line-number="4"><span class="kw"><a href="../../reference/goesaodc_plotSpatialPoints.html">goesaodc_plotSpatialPoints</a></span>(SPDF, <span class="dt">cex =</span> <span class="fl">0.2</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb6-5" data-line-number="5"><span class="kw"><a href="https://rdrr.io/r/graphics/title.html">title</a></span>(<span class="st">"SpatialPoints AOD (DQF &lt;= 3)"</span>)</a></code></pre></div>
<p><img src="aod_data_structures_files/figure-html/spatialPoints-1.png" width="700"></p>
</div>
<div id="raster" class="section level2">
<h2 class="hasAnchor">
<a href="#raster" class="anchor"></a>Raster</h2>
<p>For basic plotting needs, the <code>SpatialPointsDataFrame</code> is the highest data structure needed. But the <strong>raster</strong> package has many advanced capabilities for image processing once data have been converted into a <code>raster</code> – a data structure with a <em>rectilinear</em> rather than a <em>curvilinear</em> structure in longitude-latitude space.</p>
<p>The <code><a href="../../reference/goesaodc_createRaster.html">goesaodc_createRaster()</a></code> function takes care of loading the requested data and assigning data to a <em>rectilinear</em> grid determined by the <code>res</code> argument specifying degrees per grid cell. When multiple valid pixel values occur within a grid cell, the grid cell value is determined by applying the function specified with <code>fun</code> (averaging by default).</p>
<p>This function should be used when working with larger areas where some spatial averaging is desired. It is also possible to create rasters whose underlying grid matches that of a particular model run – allowing direct comparison.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="co"># Using previously defined variables</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2">ca_nv &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(USCensusStates, stateCode <span class="op">%in%</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"CA"</span>,<span class="st">"NV"</span>))</a>
<a class="sourceLine" id="cb7-3" data-line-number="3">ca_nv_bbox &lt;-<span class="st"> </span><span class="kw">bbox</span>(ca_nv)</a>
<a class="sourceLine" id="cb7-4" data-line-number="4"></a>
<a class="sourceLine" id="cb7-5" data-line-number="5">rstr &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/goesaodc_createRaster.html">goesaodc_createRaster</a></span>(</a>
<a class="sourceLine" id="cb7-6" data-line-number="6">  ncList[[<span class="dv">1</span>]],</a>
<a class="sourceLine" id="cb7-7" data-line-number="7">  <span class="dt">res =</span> <span class="fl">0.05</span>,</a>
<a class="sourceLine" id="cb7-8" data-line-number="8">  <span class="dt">fun =</span> mean,</a>
<a class="sourceLine" id="cb7-9" data-line-number="9">  <span class="dt">dqfLevel =</span> <span class="dv">3</span>,</a>
<a class="sourceLine" id="cb7-10" data-line-number="10">  <span class="dt">bbox =</span> ca_nv_bbox</a>
<a class="sourceLine" id="cb7-11" data-line-number="11">)</a>
<a class="sourceLine" id="cb7-12" data-line-number="12"></a>
<a class="sourceLine" id="cb7-13" data-line-number="13">raster<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span>(rstr, <span class="st">"AOD"</span>, <span class="dt">col =</span> <span class="kw"><a href="https://rdrr.io/r/base/rev.html">rev</a></span>(<span class="kw"><a href="https://rdrr.io/r/grDevices/palettes.html">heat.colors</a></span>(<span class="dv">5</span>)), <span class="dt">axes =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb7-14" data-line-number="14"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(ca_nv, <span class="dt">add =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb7-15" data-line-number="15"><span class="kw"><a href="https://rdrr.io/r/graphics/title.html">title</a></span>(<span class="st">"Raster -- AOD (DQF &lt;= 3)"</span>)</a></code></pre></div>
<p><img src="aod_data_structures_files/figure-html/raster-1.png" width="700"></p>
</div>
<div id="rasterstack" class="section level2">
<h2 class="hasAnchor">
<a href="#rasterstack" class="anchor"></a>RasterStack</h2>
<p>At the highest level of data processing is the <strong>raster</strong> package <code>rasterStack</code> data structure which combines multiple <code>raster</code> objects, typically associated with individual time steps.</p>
<p>The <strong>rasterVis</strong> package provides convenient functions for creating data visualizations covering multiple timesteps as seen in the example below.</p>
<p>The <code><a href="../../reference/goesaodc_createRasterStack.html">goesaodc_createRasterStack()</a></code> is currently an experimental function that does has not been fuly harmonized with other package functions. <strong>It will change in a future version of the package.</strong></p>
<p>As currently implemented, the <code><a href="../../reference/goesaodc_createRasterStack.html">goesaodc_createRasterStack()</a></code> does not take a vector of <code>nc</code> file handles. As currently implemented – <em>this may change</em> – the function is designed to accept information on the desired satellite, time range and area and takes care of finding and potentially downloading data files, opening NetCDF files, ingesting data and then properly closing the NetCDF files.</p>
<p>It is also possible to specify a vector of file names but the <code>satID</code> and <code>datetime</code> arguments must still be specified. Again, <em>this may change</em> in a future version</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="co"># Start by closing the nc file handles we opened at the beginning</span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="cf">for</span> ( nc <span class="cf">in</span> ncList ) {</a>
<a class="sourceLine" id="cb8-3" data-line-number="3">  ncdf4<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/ncdf4/man/nc_close.html">nc_close</a></span>(nc)</a>
<a class="sourceLine" id="cb8-4" data-line-number="4">}</a>
<a class="sourceLine" id="cb8-5" data-line-number="5"></a>
<a class="sourceLine" id="cb8-6" data-line-number="6"><span class="co"># Using previously defined variables</span></a>
<a class="sourceLine" id="cb8-7" data-line-number="7">rasterStack &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/goesaodc_createRasterStack.html">goesaodc_createRasterStack</a></span>(</a>
<a class="sourceLine" id="cb8-8" data-line-number="8">  <span class="dt">satID =</span> <span class="st">"G17"</span>,</a>
<a class="sourceLine" id="cb8-9" data-line-number="9">  <span class="dt">datetime =</span> <span class="st">"2019-10-27 14:00"</span>,</a>
<a class="sourceLine" id="cb8-10" data-line-number="10">  <span class="dt">endTime =</span> <span class="st">"2019-10-27 15:00"</span>,</a>
<a class="sourceLine" id="cb8-11" data-line-number="11">  <span class="dt">bbox =</span> kincade_bbox,</a>
<a class="sourceLine" id="cb8-12" data-line-number="12">  <span class="dt">dqfLevel =</span> <span class="dv">3</span>,</a>
<a class="sourceLine" id="cb8-13" data-line-number="13">  <span class="dt">timezone =</span> <span class="st">"America/Los_Angeles"</span>,</a>
<a class="sourceLine" id="cb8-14" data-line-number="14">  <span class="dt">res =</span> <span class="fl">0.075</span>,</a>
<a class="sourceLine" id="cb8-15" data-line-number="15">  <span class="dt">isJulian =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb8-16" data-line-number="16">  <span class="dt">fileList =</span> files,</a>
<a class="sourceLine" id="cb8-17" data-line-number="17">  <span class="dt">verbose =</span> <span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb8-18" data-line-number="18">)</a>
<a class="sourceLine" id="cb8-19" data-line-number="19"></a>
<a class="sourceLine" id="cb8-20" data-line-number="20">rasterVis<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/rasterVis/man/levelplot-methods.html">levelplot</a></span>(rasterStack, <span class="dt">par.settings =</span> rasterVis<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/rasterVis/man/rasterTheme.html">YlOrRdTheme</a></span>())</a></code></pre></div>
<p><img src="aod_data_structures_files/figure-html/rasterStack-1.png" width="700"></p>
<p>Best of luck working with AOD satellite data!</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#nativegrid">NativeGrid</a></li>
      <li><a href="#tibble">Tibble</a></li>
      <li><a href="#spatial-points">Spatial Points</a></li>
      <li><a href="#raster">Raster</a></li>
      <li><a href="#rasterstack">RasterStack</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Jonathan Callahan, Helen Miller, Raffuse Sean, Rex Thompson, Tate Brasel, Thomas Bergamaschi, Roger Andre.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
